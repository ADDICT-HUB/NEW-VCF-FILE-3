<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel — VCF</title>
<style>
body {
  font-family: 'Poppins', sans-serif;
  background: #050507;
  color: white;
  padding: 18px;
}
h2 { text-align:center; margin-bottom:16px; }
#loading { text-align:center; margin:20px 0; font-size:16px; color: #ffe600; }
table {
  width:100%;
  border-collapse: collapse;
  margin-bottom:16px;
  display:none;
}
th, td {
  border:1px solid rgba(255,255,255,0.2);
  padding:8px;
  text-align:left;
}
th {
  background: rgba(0,170,255,0.2);
}
button {
  padding:10px 14px;
  border:none;
  border-radius:6px;
  margin-right:8px;
  cursor:pointer;
  font-weight:600;
}
button:hover { opacity:0.9; }
.export-btn { background:#00aaff; color:white; }
</style>
</head>
<body>

<h2>Admin Panel — VCF Entries</h2>
<div id="loading">Loading...</div>

<table id="entriesTable">
  <thead>
    <tr>
      <th>ID</th>
      <th>Name</th>
      <th>Phone</th>
      <th>Registered At</th>
    </tr>
  </thead>
  <tbody id="entriesBody"></tbody>
</table>

<div>
  <button class="export-btn" onclick="exportCSV()">Export CSV</button>
  <button class="export-btn" onclick="exportVCF()">Download VCF</button>
</div>

<script>
// Load JSON entries
async function loadEntries() {
  try {
    const res = await fetch('entries.json'); // Make sure entries.json is in same folder
    if (!res.ok) throw new Error("Failed to fetch JSON");
    const data = await res.json();

    const tbody = document.getElementById("entriesBody");
    tbody.innerHTML = "";

    data.forEach(entry => {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${entry.id}</td>
                      <td>${entry.name}</td>
                      <td>${entry.phone}</td>
                      <td>${entry.created_at || ''}</td>`;
      tbody.appendChild(tr);
    });

    document.getElementById("loading").style.display = "none";
    document.getElementById("entriesTable").style.display = "table";
  } catch(err) {
    document.getElementById("loading").textContent = "Failed to load entries.";
    console.error(err);
  }
}

// Export CSV
function exportCSV() {
  fetch('entries.json')
    .then(res => res.json())
    .then(data => {
      if(!data.length) return alert("No data to export.");
      const headers = ["id","name","phone","created_at"];
      const rows = data.map(r => [
        r.id ?? '',
        `"${(r.name||'').replace(/"/g,'""')}"`,
        `"${(r.phone||'').replace(/"/g,'""')}"`,
        `"${(r.created_at||'')}"`
      ].join(','));
      const csv = [headers.join(','), ...rows].join('\n');
      const blob = new Blob([csv], { type:'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `vcf_entries_${new Date().toISOString().slice(0,10)}.csv`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });
}

// Export VCF
function exportVCF() {
  fetch('entries.json')
    .then(res => res.json())
    .then(data => {
      if(!data.length) return alert("No data to export.");
      const vcards = data.map(r => {
        const name = (r.name||'').replace(/[<>]/g,'');
        const phone = (r.phone||'').replace(/[<>]/g,'');
        return [
          "BEGIN:VCARD",
          "VERSION:3.0",
          `FN:${name}`,
          `TEL;TYPE=CELL:${phone}`,
          "END:VCARD"
        ].join("\r\n");
      }).join("\r\n");
      const blob = new Blob([vcards], { type:'text/vcard;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `vcf_entries_${new Date().toISOString().slice(0,10)}.vcf`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });
}

// Load entries on page load
document.addEventListener("DOMContentLoaded", loadEntries);
</script>

</body>
</html>
