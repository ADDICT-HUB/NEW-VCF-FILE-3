<!-- ===== ADMIN PANEL HTML ===== -->
<div id="vcfAdminContainer" class="glass-card" style="max-width:500px; display:none; margin:20px auto;">
  <h2 style="text-align:center; margin-bottom:12px; color:#00aaff;">Admin Panel</h2>

  <!-- Counters -->
  <div class="counters-card">
    <div class="counter">
      <div class="label-row">
        <span class="label">Registered</span>
        <span class="num" id="regCount">0</span>
      </div>
      <div class="double-track">
        <div class="outer-track"></div>
        <div class="inner-fill reg" id="regFill"></div>
        <div class="inner-fill rem" id="remFill"></div>
        <div class="inner-fill tar" id="tarFill"></div>
      </div>
    </div>
    <div class="counter">
      <div class="label-row">
        <span class="label">Remaining</span>
        <span class="num" id="remCount">0</span>
      </div>
    </div>
    <div class="counter">
      <div class="label-row">
        <span class="label">Target</span>
        <span class="num" id="tarCount">0</span>
      </div>
    </div>
  </div>

  <!-- Export Buttons -->
  <div class="form-actions" style="margin-top:16px;">
    <button class="btn more" onclick="exportCSV()">Export CSV</button>
    <button class="btn more" onclick="exportVCF()">Download VCF</button>
    <button class="btn more" onclick="exportPDF()">Download PDF</button>
  </div>

  <!-- Table of Registered Users -->
  <div style="margin-top:20px; max-height:300px; overflow-y:auto;">
    <table style="width:100%; border-collapse:collapse; color:#fff;">
      <thead>
        <tr>
          <th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,0.2)">ID</th>
          <th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,0.2)">Name</th>
          <th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,0.2)">Phone</th>
          <th style="text-align:left; padding:6px; border-bottom:1px solid rgba(255,255,255,0.2)">Registered</th>
        </tr>
      </thead>
      <tbody id="vcfAdminTable">
        <!-- JS will populate -->
      </tbody>
    </table>
  </div>
</div>

<script>
  // Show Admin Panel
  function showAdminPanel() {
    const container = document.getElementById("vcfAdminContainer");
    if(container) container.style.display = "block";
    updateAdminTable();
  }

  // Populate Table
  async function updateAdminTable() {
    if(!window.supabase) return console.error("Supabase not loaded");
    const tableBody = document.getElementById("vcfAdminTable");
    if(!tableBody) return;

    try {
      const { data, error } = await supabase.from("vcf_entries").select("*").order("id", { ascending:true });
      if(error) throw error;

      tableBody.innerHTML = ""; // clear

      data.forEach(r => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td style="padding:6px; border-bottom:1px solid rgba(255,255,255,0.1)">${r.id || ""}</td>
          <td style="padding:6px; border-bottom:1px solid rgba(255,255,255,0.1)">${(r.name||"").replace(/[<>]/g,"")}</td>
          <td style="padding:6px; border-bottom:1px solid rgba(255,255,255,0.1)">${(r.phone||"").replace(/[<>]/g,"")}</td>
          <td style="padding:6px; border-bottom:1px solid rgba(255,255,255,0.1)">${r.created_at ? new Date(r.created_at).toLocaleString() : ""}</td>
        `;
        tableBody.appendChild(tr);
      });

      // Update counters
      const reg = data.length;
      const rem = Math.max(0, TARGET - reg);
      if(regCountEl()) regCountEl().textContent = reg;
      if(remCountEl()) remCountEl().textContent = rem;
      if(tarCountEl()) tarCountEl().textContent = TARGET;
      if(regFillEl()) regFillEl().style.width = (reg/TARGET)*100+"%";
      if(remFillEl()) remFillEl().style.width = (rem/TARGET)*100+"%";
      if(tarFillEl()) tarFillEl().style.width = "100%";
      
    } catch(err) {
      console.error("Admin table load error:", err);
    }
  }

  // Auto-refresh table every 8 seconds
  setInterval(updateAdminTable, 8000);

</script>
