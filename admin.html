<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel — VCF Entries</title>
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: #0a0a0a;
    color: #fff;
    padding: 16px;
  }
  h1 { text-align: center; margin-bottom: 16px; }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 16px;
  }
  th, td {
    padding: 8px 12px;
    border: 1px solid #444;
    text-align: left;
  }
  th { background: #111; }
  tr:nth-child(even){ background: #1a1a1a; }
  #loading { text-align: center; margin-top: 12px; }
  button { padding: 8px 12px; border-radius: 6px; border:none; background:#00aaff; color:#fff; cursor:pointer; }
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.23.0/dist/supabase.min.js"></script>
</head>
<body>

<h1>Admin Panel — Registered Numbers</h1>
<div id="loading">Loading...</div>
<table id="entriesTable" style="display:none;">
  <thead>
    <tr>
      <th>#</th>
      <th>Name</th>
      <th>Phone</th>
      <th>Registered At</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div style="text-align:center;">
  <button id="logoutBtn">Logout</button>
</div>

<script>
// === SUPABASE CONFIG ===
const SUPABASE_URL = "https://hkxmgufbjqmncwbydtht.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhreG1ndWZianFtbmN3YnlkdGh0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyNjg0NDMsImV4cCI6MjA4MDg0NDQ0M30.1yaFlEJqGVg48R57IliLVnkNAiYAFIBmZEdzJX9NRfY";
const TABLE = "vcf_entries";

// Initialize Supabase
const supabase = window.Supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// Fetch entries
async function fetchEntries() {
  const loading = document.getElementById("loading");
  const table = document.getElementById("entriesTable");
  const tbody = table.querySelector("tbody");
  loading.style.display = "block";
  table.style.display = "none";

  try {
    const { data, error } = await supabase.from(TABLE).select("*").order("id", { ascending: true });
    if (error) throw error;

    tbody.innerHTML = "";
    if (!data || data.length === 0) {
      tbody.innerHTML = `<tr><td colspan="4" style="text-align:center;">No registered entries</td></tr>`;
    } else {
      data.forEach((row, idx) => {
        const created = row.created_at ? new Date(row.created_at).toLocaleString() : "";
        tbody.innerHTML += `
          <tr>
            <td>${idx + 1}</td>
            <td>${row.name || ""}</td>
            <td>${row.phone || ""}</td>
            <td>${created}</td>
          </tr>`;
      });
    }
    loading.style.display = "none";
    table.style.display = "table";
  } catch (err) {
    loading.textContent = "Error loading entries: " + err.message;
    console.error(err);
  }
}

// Logout button
document.getElementById("logoutBtn").addEventListener("click", () => {
  window.location.href = "index.html"; // go back to your main page
});

// Fetch entries on load
fetchEntries();
</script>

</body>
</html>
